<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buss 4 Positioner</title>
    <style>
        /* Grundläggande CSS för att styla positionerna */
        #positions {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>Buss 4 Positioner</h1>
    <div id="positions">Laddar positioner...</div>

    <script>
        const busLine = '9011001000400000'; // route_id för buss 4

        async function fetchBusPositions() {
            try {
                // Hämta data från Flask-servern
                const response = await fetch('http://127.0.0.1:5000/fetch_vehicle_positions'); // Byt ut med din Flask-server IP
                if (!response.ok) throw new Error('Nätverksfel: ' + response.status);
                
                const data = await response.json();
                displayBusPositions(data.entity);
            } catch (error) {
                document.getElementById('positions').innerText = 'Fel vid hämtning av data: ' + error.message;
            }
        }

        function displayBusPositions(entities) {
            const positionsDiv = document.getElementById('positions');
            positionsDiv.innerHTML = ''; // Töm tidigare innehåll

            entities.forEach(entity => {
                if (entity.vehicle && entity.vehicle.trip && entity.vehicle.trip.route_id === busLine) {
                    const position = entity.vehicle.position;
                    const timestamp = new Date(entity.vehicle.timestamp * 1000).toLocaleString();

                    positionsDiv.innerHTML += `<p>Buss ID: ${entity.vehicle.id}, Position: (${position.latitude}, ${position.longitude}), Tid: ${timestamp}</p>`;
                }
            });

            if (positionsDiv.innerHTML === '') {
                positionsDiv.innerText = 'Inga positioner för buss 4 hittades.';
            }
        }

        // Hämta positioner varje 30 sekunder
        fetchBusPositions();
        setInterval(fetchBusPositions, 30000);
    </script>
</body>
</html>
